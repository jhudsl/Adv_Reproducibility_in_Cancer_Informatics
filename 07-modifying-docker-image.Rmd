
```{r, include = FALSE}
leanbuild::set_knitr_image_path()
```

# Modifying a Docker image

## Learning Objectives

```{r, fig.alt="Learning Objectives. This chapter will demonstrate how to: Modify an existing Docker image. Store a Docker image on dockerhub. Incorporate Docker image use into a project.", out.width = "100%", echo = FALSE}
leanbuild::include_slide("https://docs.google.com/presentation/d/1IJ_uFxJud7OdIAr6p8ZOzvYs-SGDqa7g4cUHtUld03I/edit#slide=id.gfbc11e6ab0_0_149")
```

***

The docker image you are using from the last chapter was pre-made for you, but you will find depending on the needs of your project, that you may need different packages installed. In this chapter we will introduce you to the basics of how to manage your own Docker image.

## Managing images

Images can be on your own computer or on dockerhub.
To see your list of images on your computer, you can go to Docker desktop. From here you will want to delete images and containers periodically because they do take up room on your computer.

```{r, fig.alt="A reminder of where to find your current local images. Open up Docker desktop. Click on ‘images’ on the left. This shows the images you have available on your computer. If you hover your mouse over one of these images, you will see a Run button appear. Click the Run button to start a container with this image.", out.width = "100%", echo = FALSE}
leanbuild::include_slide("https://docs.google.com/presentation/d/1IJ_uFxJud7OdIAr6p8ZOzvYs-SGDqa7g4cUHtUld03I/edit#slide=id.gfc8849fa4d_0_17")
```

To see what images you have on your internet repository, you can log on to dockerhub.
[Go here to login (or create a username if you have not yet)](https://hub.docker.com/).

```{r, fig.alt="The dockerhub login page.", out.width = "100%", echo = FALSE}
leanbuild::include_slide("https://docs.google.com/presentation/d/1IJ_uFxJud7OdIAr6p8ZOzvYs-SGDqa7g4cUHtUld03I/edit#slide=id.gfc8849fa4d_0_38")
```

After you sign into dockerhub, you can see the list of repositories you have stored online. At this point, you won’t have any if you just created your dockerhub account. To create a new repository, click the ‘Create Repository’ button.

```{r, fig.alt="In your dockerhub main page, you can see the list of repositories you have stored online. At this point, you won’t have any if you just created your dockerhub account. To create a new repository, click the ‘Create Repository’ button.", out.width = "100%", echo = FALSE}
leanbuild::include_slide("https://docs.google.com/presentation/d/1IJ_uFxJud7OdIAr6p8ZOzvYs-SGDqa7g4cUHtUld03I/edit#slide=id.gfc8849fa4d_0_10")
```

Upon adding the new repository to dockerhub, you will need name it the same as whatever you are calling it locally. You can put a description and name and click create. On the right it shows how you can interact with this from your local command line.

```{r, fig.alt="Upon adding the new repository to dockerhub, you will need name it the same as whatever you are calling it locally. You can put a description and name and click create. On the right it shows how you can interact with this from your local command line.", out.width = "100%", echo = FALSE}
leanbuild::include_slide("https://docs.google.com/presentation/d/1IJ_uFxJud7OdIAr6p8ZOzvYs-SGDqa7g4cUHtUld03I/edit#slide=id.gfc8849fa4d_0_48")
```

After you've created the image repository, you will be brought to the image repository page.
It will tell you `Last pushed: never`. On the right it will tell you the command you will need in order to push the image to dockerhub.

```{r, fig.alt="After you've created the image repository, you will be brought to the image repository page. It will tell you `Last pushed: never`. On the right it will tell you the command you will need in order to push the image to dockerhub.", out.width = "100%", echo = FALSE}
leanbuild::include_slide(https://docs.google.com/presentation/d/1IJ_uFxJud7OdIAr6p8ZOzvYs-SGDqa7g4cUHtUld03I/edit#slide=id.gfc8849fa4d_0_56")
```

Go to your [local command line]((https://towardsdatascience.com/a-quick-guide-to-using-command-line-terminal-96815b97b955)) and use the command specified on the right side of your repository page. You don't have to specify a tagname if you don't want to.  If you don't want to specify a tagname, leave off the `:tagname` if you like.

Now you will be able to test pulling your image using `docker pull <image name>` like we did in the previous chapter.

## Modifying images

Docker images can be pulled from being stored online but these images are built originally from a `Dockerfile`.

A Dockerfile is a recipe for how to build a docker image. You can take a look at our docker images for these examples:  

- The [Dockerfile for `jhudsl/reproducible-r`](https://raw.githubusercontent.com/jhudsl/reproducible-R-example/main/docker/Dockerfile)
- The [Dockerfile for `jhudsl/reproducible-python`](https://raw.githubusercontent.com/jhudsl/reproducible-python-example/main/docker/Dockerfile)

Dockerfiles have [these main commands as described by the Docker documentation](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/):

> FROM creates a layer from the ubuntu:18.04 Docker image.
COPY adds files from your Docker client’s current directory.
RUN builds your application with make.
CMD specifies what command to run within the container.


The best way to learn to write Dockerfiles is to start off with one that is already written and modify it for your needs.

You can practice building a docker image by downloading the dockerfiles we have started.
[Dockerfile for `jhudsl/reproducible-python`](https://raw.githubusercontent.com/jhudsl/reproducible-python-example/main/docker/Dockerfile)

As you modify that Dockerfile, you can build it with a command like such. Where `docker/Dockerfile` is the path to a dockerfile, and `-t` is is what you'd like the image to be called.

```
docker build -f docker/Dockerfile . -t jhudsl/reproducible-python
```
